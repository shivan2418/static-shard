<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>static-shard Demo - Product Search</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }

    .filters {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
    }

    .filter-group label {
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }

    .filter-group input,
    .filter-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .filter-group input:focus,
    .filter-group select:focus {
      outline: none;
      border-color: #0066cc;
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }

    button.primary {
      background: #0066cc;
      color: white;
    }

    button.primary:hover {
      background: #0052a3;
    }

    button.secondary {
      background: #e0e0e0;
      color: #333;
    }

    button.secondary:hover {
      background: #d0d0d0;
    }

    .stats {
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .stats .count {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .stats .performance {
      color: #666;
      font-size: 14px;
    }

    .stats .chunks {
      background: #e8f4e8;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 13px;
      color: #2e7d32;
    }

    .results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .product-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .product-card h3 {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #333;
    }

    .product-card .category {
      display: inline-block;
      background: #e3f2fd;
      color: #1565c0;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-bottom: 10px;
    }

    .product-card .brand {
      color: #666;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .product-card .price {
      font-size: 20px;
      font-weight: 700;
      color: #2e7d32;
    }

    .product-card .original-price {
      font-size: 14px;
      color: #999;
      text-decoration: line-through;
      margin-left: 8px;
    }

    .product-card .meta {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 13px;
      color: #666;
    }

    .product-card .rating {
      color: #ffc107;
    }

    .product-card .stock {
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
    }

    .product-card .stock.in-stock {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .product-card .stock.out-of-stock {
      background: #ffebee;
      color: #c62828;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    .pagination button {
      min-width: 100px;
    }

    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Product Search Demo</h1>
  <p class="subtitle">Powered by static-shard - querying 5,000 products with intelligent chunk loading</p>

  <div class="filters">
    <div class="filter-group">
      <label for="search">Search</label>
      <input type="text" id="search" placeholder="Search products...">
    </div>

    <div class="filter-group">
      <label for="category">Category</label>
      <select id="category">
        <option value="">All Categories</option>
        <option value="Electronics">Electronics</option>
        <option value="Clothing">Clothing</option>
        <option value="Home & Garden">Home & Garden</option>
        <option value="Sports">Sports</option>
        <option value="Books">Books</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="brand">Brand</label>
      <select id="brand">
        <option value="">All Brands</option>
        <option value="TechCorp">TechCorp</option>
        <option value="StyleCo">StyleCo</option>
        <option value="HomeBasics">HomeBasics</option>
        <option value="SportsPro">SportsPro</option>
        <option value="ReadMore">ReadMore</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="minPrice">Min Price</label>
      <input type="number" id="minPrice" placeholder="0" min="0">
    </div>

    <div class="filter-group">
      <label for="maxPrice">Max Price</label>
      <input type="number" id="maxPrice" placeholder="1000" min="0">
    </div>

    <div class="filter-group">
      <label for="inStock">Stock</label>
      <select id="inStock">
        <option value="">Any</option>
        <option value="true">In Stock</option>
        <option value="false">Out of Stock</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="sortBy">Sort By</label>
      <select id="sortBy">
        <option value="name">Name</option>
        <option value="price">Price (Low to High)</option>
        <option value="price-desc">Price (High to Low)</option>
        <option value="rating">Rating</option>
      </select>
    </div>

    <div class="filter-group actions">
      <button class="primary" onclick="search()">Search</button>
      <button class="secondary" onclick="clearFilters()">Clear</button>
    </div>
  </div>

  <div id="stats" class="stats" style="display: none;">
    <span class="count"><span id="resultCount">0</span> products found</span>
    <span class="performance">Query took <span id="queryTime">0</span>ms</span>
    <span class="chunks">Loaded <span id="chunksLoaded">0</span> chunks</span>
  </div>

  <div id="error" class="error" style="display: none;"></div>

  <div id="loading" class="loading" style="display: none;">
    Loading products...
  </div>

  <div id="results" class="results"></div>

  <div id="pagination" class="pagination" style="display: none;">
    <button class="secondary" id="prevBtn" onclick="prevPage()">Previous</button>
    <span id="pageInfo">Page 1</span>
    <button class="secondary" id="nextBtn" onclick="nextPage()">Next</button>
  </div>

  <script type="module">
    // Import the generated client
    import { createClient } from './data/client.js';

    const db = createClient({ basePath: './data' });

    // Track loaded chunks for display
    let chunksLoaded = 0;
    let currentPage = 1;
    const pageSize = 20;
    let totalResults = 0;

    // Make functions available globally
    window.search = search;
    window.clearFilters = clearFilters;
    window.prevPage = prevPage;
    window.nextPage = nextPage;

    async function search() {
      const searchInput = document.getElementById('search').value;
      const category = document.getElementById('category').value;
      const brand = document.getElementById('brand').value;
      const minPrice = document.getElementById('minPrice').value;
      const maxPrice = document.getElementById('maxPrice').value;
      const inStock = document.getElementById('inStock').value;
      const sortBy = document.getElementById('sortBy').value;

      // Build where clause
      const where = {};

      if (category) {
        where.category = category;
      }

      if (brand) {
        where.brand = brand;
      }

      if (inStock) {
        where.inStock = inStock === 'true';
      }

      if (minPrice || maxPrice) {
        where.price = {};
        if (minPrice) where.price.gte = parseFloat(minPrice);
        if (maxPrice) where.price.lte = parseFloat(maxPrice);
      }

      // Build query options
      let orderBy;
      if (sortBy === 'price-desc') {
        orderBy = { field: 'price', direction: 'desc' };
      } else if (sortBy) {
        orderBy = sortBy;
      }

      // Show loading
      document.getElementById('loading').style.display = 'block';
      document.getElementById('results').innerHTML = '';
      document.getElementById('error').style.display = 'none';

      try {
        const startTime = performance.now();

        // Get all results for count (in production, you might want a count endpoint)
        const allResults = await db.query({
          where: Object.keys(where).length > 0 ? where : undefined,
          orderBy,
        });

        // Filter by search term in-memory (name contains)
        let filteredResults = allResults;
        if (searchInput) {
          const searchLower = searchInput.toLowerCase();
          filteredResults = allResults.filter(p =>
            p.name.toLowerCase().includes(searchLower)
          );
        }

        totalResults = filteredResults.length;

        // Paginate
        const offset = (currentPage - 1) * pageSize;
        const pageResults = filteredResults.slice(offset, offset + pageSize);

        const endTime = performance.now();
        const queryTime = Math.round(endTime - startTime);

        // Update stats
        document.getElementById('stats').style.display = 'flex';
        document.getElementById('resultCount').textContent = totalResults;
        document.getElementById('queryTime').textContent = queryTime;
        document.getElementById('chunksLoaded').textContent = 'some'; // Can't easily track this without modifying client

        // Update pagination
        const totalPages = Math.ceil(totalResults / pageSize);
        document.getElementById('pagination').style.display = totalResults > pageSize ? 'flex' : 'none';
        document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
        document.getElementById('prevBtn').disabled = currentPage === 1;
        document.getElementById('nextBtn').disabled = currentPage >= totalPages;

        // Render results
        renderResults(pageResults);
      } catch (err) {
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = `Error: ${err.message}`;
        console.error(err);
      } finally {
        document.getElementById('loading').style.display = 'none';
      }
    }

    function renderResults(products) {
      const container = document.getElementById('results');

      if (products.length === 0) {
        container.innerHTML = '<div class="loading">No products found matching your criteria.</div>';
        return;
      }

      container.innerHTML = products.map(product => `
        <div class="product-card">
          <span class="category">${product.category}</span>
          <h3>${product.name}</h3>
          <div class="brand">${product.brand} - ${product.color}</div>
          <div>
            <span class="price">$${product.price.toFixed(2)}</span>
            <span class="original-price">$${product.originalPrice.toFixed(2)}</span>
          </div>
          <div class="meta">
            <span class="rating">${'★'.repeat(product.rating)}${'☆'.repeat(5 - product.rating)} (${product.reviewCount})</span>
            <span class="stock ${product.inStock ? 'in-stock' : 'out-of-stock'}">
              ${product.inStock ? 'In Stock' : 'Out of Stock'}
            </span>
          </div>
        </div>
      `).join('');
    }

    function clearFilters() {
      document.getElementById('search').value = '';
      document.getElementById('category').value = '';
      document.getElementById('brand').value = '';
      document.getElementById('minPrice').value = '';
      document.getElementById('maxPrice').value = '';
      document.getElementById('inStock').value = '';
      document.getElementById('sortBy').value = 'name';
      currentPage = 1;
      search();
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        search();
      }
    }

    function nextPage() {
      const totalPages = Math.ceil(totalResults / pageSize);
      if (currentPage < totalPages) {
        currentPage++;
        search();
      }
    }

    // Initial search
    search();
  </script>
</body>
</html>
